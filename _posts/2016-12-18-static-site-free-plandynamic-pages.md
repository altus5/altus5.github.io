free-plan---
layout: post
title:  "静的サイトを動的ページ化する - 無料枠でどこまでできる？"
date:   2016-12-18 10:00:00 +0900
categories: blog static-site
---
## 無料で使える WEB API を活用して、動的ページ化してみる

無料枠が用意されたサービスを、うまく組み合わせると、無料でサイトの運営ができます。  
コーポレートサイトによくある「お問い合わせフォーム」を、静的サイトに搭載してみたので、ご紹介します。  

まずは、無料で使える静的サイトを構築します。  
利用するサービスは、次のとおりです。  

* GitHub Pages
* Cloudflare
* CircleCI

WEBで検索すると GitHub Pages で独自メインを使うための記事が、いくつも見つかりますが、
とりあえず、静的サイトを無償で運営するだけだったら、やり方は同じなので、
それらの記事を参考に、構築されてください。  

次に、「お問い合わせフォーム」のある動的ページを、搭載する方法です。  
次のサービスを利用します。  

* Firebase
* Google App Script
* Gmail

お問い合わせのフォームに入力された内容は、企業の担当者にメール送信するわけですが、
javascript だけでメール送信することはできないので、なんらかの WEB サービスを
利用することになります。  
例えば、 SendGrid など REST API のインターフェースが用意されているサービスであれば、
javascript からでも、その API にリクエストすれば、メール送信も出来そうです。  
しかし、 API を利用するときのアクセスキーなどは、第3者に読まれて、悪用される可能性が
あるため、このやり方は、お勧めできません。  

そこで、 Firebase の DB を一時保存に使った、バッチ処理での方法を、ご紹介します。  
Firebase も、それへのアクセスのためのキー情報などを、 javascript の中に、
埋め込みますが、 Firebase の DB には、利用者毎に、権限の設定ができるので、
認証を必要としないユーザーと、認証を必要とするユーザーの2種類に分けて、
認証無しユーザー（お問い合わせフォームで入力したユーザー）に対しては、
書き込み専用で読み取り不可に設定し、企業側の担当者には、認証有りで読み書き可能に
設定します。  

こうすることによって、 javascript に Firebase へのキー情報が含まれていても、
読み取りできないので、お問い合わせ情報を第3者に盗み取られる心配はありませんし、
メール送信するわけでもないので、SPAMの踏み台にされる心配もありません。  

次に、登録されたお問い合わせ内容のメール送信ですが、
これには、 Google App Script (GAS) でバッチ処理となるスクリプトを作成して、
1分間隔で、トリガー実行します。  
GAS を実行するアカウントと、Firebaseのカウントは同じものにして、
OAuth 認証もしておいて、 Firebase における認証済ユーザーの権限でアクセスします。  
これで、 GAS で Firebase から取り出して、 Gmail API を使って送信して、 
Firebase から削除する、という処理がセキュアに実行されます。  

Firebase、GAS、Gmail それぞれに、利用回数や量に、無料枠の制約がありますが、
1日に100件くらいの問い合わせは、余裕で処理できます。  
中小企業のコーポレートサイトのお問い合わせフォームなら、十分ではないでしょうか。  

## 静的サイトジェネレータでブログ公開

上記の内容は、実際に、ひととおり、やってみて、うまく動きました。  

しかし、このやり方は、あえて、無料枠で使えるサービスを、とことん探してみた結果、
ここまでやれば、実現できるというだけの話です。  
ややこしいし、6つものサービスのアカウントは、そのうち、IDとパスワードを
忘れてしまうかもしれないし、担当が変わるときに、この仕組みと理屈を引き継ぐことを
想像すると、かなり面倒です。  
「無料」ということが理由なら、やらない方が良いです。  

今どき、月額1000円以内で、 WP 付きのレンタルサーバーが使えるのに、
あえて、この形態で、サイトを運営するのは、無料枠を使いたいことが理由ではなくて、
エンジニアの面倒くさい事情によるものです。  
調べ始めたら、止まらなくて、いつの間にか、「無料で運営する○○」というシナリオを
自分で作ってしまっていたんですね。困ったもんです。 (＾-＾；)

似たような事情が、ブログ運営にもあります。  
弊社でも、ブログを公開し始めましたが、 GitHub Pages で、HPと同居して運営していて、
1. 記事を書いて git でプッシュすると、 
1. CircleCI が反応して、静的サイトジェネレータが実行され、  
1. 静的コンテンツが生成されて、  
1. そのコンテンツを、 CircleCI から、GitHub Pages にプッシュして、
1. 公開  

という仕組みになっています。  

プログラムを作成するのと同じ、いつものエディタで md で記事を書いて、
プッシュしたら、数分後には公開されている・・・、これが、ここち良いです。  
WP や、はてなブログではなくて、いつものエディタで・・・というところに、
こだわりたい人には、おすすめです。

## お問い合わせください

前述のとおり、静的サイト上に、動的アプリを構築することが可能です。  
コーポレートサイトのお問い合わせフォーム以上の、もっと、複雑なアプリケーションも
構築可能です。  

例えば、 WP で作られたポータルサイトをお持ちの会社様の場合、アクセス数が伸びてくると、
段階的に、サーバーの性能を増強することを検討されると思いますが、
静的サイトとして、構築してある場合、その心配をする必要がなくなるかもしれません。  
静的サイトの設置先として、Amazon の S3 や、GitHub Pages を選択すると、
そのサービス自体が、すでに、大多数のユーザーのために、性能バランスを取っているので、
個別にアレコレする必要がありません。  
それほど大規模じゃないポータルサイトなら、静的サイトとして再構築してみることを、
ご検討されては、いかがでしょうか？

他にも、静的サイトに動的な機能を追加したい方、あるいは、この記事にご興味をお持ちになった方も、お気軽に、お問い合わせくださいませ。  
https://www.altus5.io/contact/

